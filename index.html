<!DOCTYPE html>    
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karapatan Pinoy - Legal AI Assistant</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #ffd700;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            margin-top: 10px;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .api-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }
        
        .api-section h3 {
            color: #d32f2f;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        #apiKeyInput {
            width: 100%;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 1rem;
        }
        
        .connect-btn {
            width: 100%;
            padding: 17px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .connect-btn:hover {
            background: #b71c1c;
            transform: translateY(-2px);
        }
        
        .connect-btn.connected {
            background: #388e3c;
        }
        
        .connect-btn.connected:hover {
            background: #2e7d32;
        }
        
        .connect-btn:disabled {
            background: #757575;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .status.connected { 
            background: #e8f5e9; 
            color: #1b5e20; 
            border: 2px solid #c8e6c9;
        }
        
        .status.disconnected { 
            background: #ffebee; 
            color: #c62828; 
            border: 2px solid #ffcdd2;
        }
        
        .chat-interface {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        #chatHistory {
            height: 350px;
            overflow-y: auto;
            padding: 20px;
            background: #fafafa;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .message {
            margin-bottom: 20px;
        }
        
        .user-message {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 20px 20px 0 20px;
            margin-left: auto;
            max-width: 85%;
            box-shadow: 0 3px 10px rgba(211, 47, 47, 0.2);
        }
        
        .ai-message {
            background: white;
            border: 1px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 20px 20px 20px 0;
            max-width: 85%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .input-area {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        #userInput {
            flex: 1;
            padding: 17px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            min-height: 60px;
            resize: none;
            font-family: inherit;
        }
        
        #sendButton {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #sendButton:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3);
        }
        
        #sendButton:disabled {
            background: #9e9e9e;
            cursor: not-allowed;
        }
        
        .laws-section {
            background: #fff3e0;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #ff9800;
        }
        
        .laws-section h3 {
            color: #e65100;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .laws-section h3::before {
            content: "‚öñÔ∏è";
        }
        
        .law-category {
            margin-bottom: 20px;
        }
        
        .law-category h4 {
            color: #d84315;
            margin-bottom: 10px;
            font-size: 1.1rem;
            padding-bottom: 5px;
            border-bottom: 2px solid #ffcc80;
        }
        
        .law-titles {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .law-title {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #333;
            border: 1px solid #ffe0b2;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
            background: #f5f5f5;
        }
        
        .footer .powered-by {
            font-size: 1rem;
            font-weight: 600;
            color: #d32f2f;
            margin-bottom: 5px;
        }
        
        .footer .secured-by {
            font-size: 1.2rem;
            font-weight: 700;
            color: #388e3c;
            letter-spacing: 1px;
        }
        
        @media (max-width: 768px) {
            .input-area {
                flex-direction: column;
            }
            
            #sendButton {
                width: 100%;
                padding: 17px;
            }
            
            .law-titles {
                flex-direction: column;
            }
            
            .law-title {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Karapatan Pinoy</h1>
            <div class="subtitle">Legal AI Assistant for Filipinos</div>
        </div>
        
        <div class="main-content">
            <!-- API Configuration -->
            <div class="api-section">
                <h3>üîê Secure Connection</h3>
                <input type="password" id="apiKeyInput" placeholder="Enter your DeepSeek API key">
                
                <button class="connect-btn" id="connectBtn" onclick="toggleConnection()">
                    Connect to AI
                </button>
                
                <div id="apiStatus" class="status disconnected">
                    Enter API key and click Connect
                </div>
            </div>
            
            <!-- Chat Interface -->
            <div class="chat-interface">
                <div id="chatHistory">
                    <div class="message">
                        <div class="ai-message">Welcome to Karapatan Pinoy Legal AI Assistant. Connect your API key to start asking legal questions about Philippine laws.</div>
                    </div>
                </div>
                
                <div class="input-area">
                    <textarea id="userInput" placeholder="Ask about Philippine law (e.g., divorce, annulment, rights, contracts)..." disabled></textarea>
                    <button id="sendButton" onclick="sendMessage()" disabled>Send</button>
                </div>
            </div>
            
            <!-- Embedded Laws -->
            <div class="laws-section">
                <h3>Embedded Philippine Legal Database</h3>
                
                <div class="law-category">
                    <h4>Constitution (Bill of Rights)</h4>
                    <div class="law-titles">
                        <div class="law-title">Due Process & Equal Protection</div>
                        <div class="law-title">Right Against Unreasonable Searches</div>
                        <div class="law-title">Privacy of Communication</div>
                        <div class="law-title">Freedom of Speech</div>
                        <div class="law-title">Rights of Persons Under Investigation</div>
                    </div>
                </div>
                
                <div class="law-category">
                    <h4>Family Code</h4>
                    <div class="law-titles">
                        <div class="law-title">Marriage as Special Contract</div>
                        <div class="law-title">Grounds for Annulment</div>
                        <div class="law-title">Legal Separation Grounds</div>
                    </div>
                </div>
                
                <div class="law-category">
                    <h4>Civil Code</h4>
                    <div class="law-titles">
                        <div class="law-title">Human Relations Principle</div>
                        <div class="law-title">Obligations & Contracts</div>
                    </div>
                </div>
                
                <div class="law-category">
                    <h4>Labor Code</h4>
                    <div class="law-titles">
                        <div class="law-title">Normal Working Hours</div>
                        <div class="law-title">Security of Tenure</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="powered-by">Powered and secured by</div>
            <div class="secured-by">RP8</div>
        </div>
    </div>

    <script>
        // USE THIS PROXY URL - Replace with your actual Vercel URL
        const PROXY_URL = '/api/deepseek'; // Change to: 'https://your-app.vercel.app/api/deepseek'
        let userApiKey = null;
        let isConnected = false;
        
        // DOM Elements
        const apiKeyInput = document.getElementById('apiKeyInput');
        const connectBtn = document.getElementById('connectBtn');
        const apiStatus = document.getElementById('apiStatus');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        
        // Toggle connection
        function toggleConnection() {
            if (!isConnected) {
                connectApi();
            } else {
                disconnectApi();
            }
        }
        
        // Connect to AI
        async function connectApi() {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey.startsWith('sk-')) {
                apiStatus.textContent = '‚ùå Invalid API key format';
                apiStatus.className = 'status disconnected';
                return;
            }
            
            // Update UI
            connectBtn.textContent = 'Connecting...';
            connectBtn.disabled = true;
            apiStatus.textContent = 'Testing connection...';
            apiStatus.className = 'status disconnected';
            
            userApiKey = apiKey;
            
            // Test connection through proxy
            try {
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: "test" }],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    isConnected = true;
                    localStorage.setItem('karapan_api_key', apiKey);
                    
                    // Update UI for connected state
                    connectBtn.textContent = 'Disconnect from AI';
                    connectBtn.className = 'connect-btn connected';
                    connectBtn.disabled = false;
                    
                    apiStatus.textContent = '‚úÖ Connected to Karapatan Pinoy AI';
                    apiStatus.className = 'status connected';
                    
                    userInput.disabled = false;
                    sendButton.disabled = false;
                    apiKeyInput.type = 'password';
                    
                    // Update chat
                    document.getElementById('chatHistory').innerHTML = `
                        <div class="message">
                            <div class="ai-message">‚úÖ Connected successfully to Karapatan Pinoy! You can now ask legal questions about Philippine laws.</div>
                        </div>
                    `;
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Connection failed');
                }
                
            } catch (error) {
                console.error('Connection error:', error);
                isConnected = false;
                userApiKey = null;
                
                connectBtn.textContent = 'Connect to AI';
                connectBtn.className = 'connect-btn';
                connectBtn.disabled = false;
                
                if (error.message.includes('Failed to fetch')) {
                    apiStatus.innerHTML = '‚ùå CORS blocked.<br><br>1. Ensure /api/deepseek.js is deployed<br>2. Use correct proxy URL<br>3. Check Vercel logs';
                } else {
                    apiStatus.textContent = `‚ùå ${error.message}`;
                }
                apiStatus.className = 'status disconnected';
            }
        }
        
        // Disconnect from AI
        function disconnectApi() {
            isConnected = false;
            userApiKey = null;
            localStorage.removeItem('karapan_api_key');
            
            connectBtn.textContent = 'Connect to AI';
            connectBtn.className = 'connect-btn';
            
            apiStatus.textContent = 'Disconnected from AI';
            apiStatus.className = 'status disconnected';
            
            userInput.disabled = true;
            sendButton.disabled = true;
            apiKeyInput.type = 'text';
            
            document.getElementById('chatHistory').innerHTML = `
                <div class="message">
                    <div class="ai-message">Disconnected from Karapatan Pinoy. Enter your API key and click Connect to resume.</div>
                </div>
            `;
        }
        
        // Send message through proxy
        async function sendMessage() {
            const message = userInput.value.trim();
            const chatHistory = document.getElementById('chatHistory');
            
            if (!message || !isConnected || !userApiKey) return;
            
            // Add user message
            chatHistory.innerHTML += `
                <div class="message">
                    <div class="user-message">${message}</div>
                </div>
            `;
            
            userInput.value = '';
            sendButton.textContent = 'Thinking...';
            sendButton.disabled = true;
            
            try {
                // Embedded Philippine laws (full text for AI)
                const PHILIPPINE_LAWS = [
                    { id: "CONST_1", title: "Due Process & Equal Protection", text: "No person shall be deprived of life, liberty, or property without due process of law, nor shall any person be denied the equal protection of the laws. (Article III, Section 1)" },
                    { id: "CONST_2", title: "Right Against Unreasonable Searches", text: "The right of the people to be secure in their persons, houses, papers, and effects against unreasonable searches and seizures shall be inviolable. (Article III, Section 2)" },
                    { id: "CONST_3", title: "Privacy of Communication", text: "The privacy of communication and correspondence shall be inviolable except upon lawful order of the court. (Article III, Section 3)" },
                    { id: "CONST_4", title: "Freedom of Speech", text: "No law shall be passed abridging the freedom of speech, of expression, or of the press. (Article III, Section 4)" },
                    { id: "CONST_12", title: "Rights of Persons Under Investigation", text: "Any person under investigation shall have the right to remain silent and to have competent counsel. If unable to afford counsel, one must be provided. (Article III, Section 12)" },
                    { id: "FAM_1", title: "Marriage as Special Contract", text: "Marriage is a special contract of permanent union between a man and a woman entered into in accordance with law. (Family Code, Article 1)" },
                    { id: "FAM_45", title: "Grounds for Annulment", text: "A marriage may be annulled for causes including: (1) Lack of parental consent; (2) Insanity; (3) Fraud; (4) Force; (5) Impotence. (Family Code, Article 45)" },
                    { id: "FAM_55", title: "Legal Separation Grounds", text: "Legal separation may be granted for: (1) Repeated physical violence; (2) Drug addiction; (3) Attempt against life; (4) Sexual infidelity. (Family Code, Article 55)" },
                    { id: "CIV_19", title: "Human Relations Principle", text: "Every person must, in the exercise of his rights and in the performance of his duties, act with justice, give everyone his due, and observe honesty and good faith. (Civil Code, Article 19)" },
                    { id: "CIV_1156", title: "Definition of Obligation", text: "An obligation is a juridical necessity to give, to do or not to do. (Civil Code, Article 1156)" },
                    { id: "LAB_82", title: "Normal Working Hours", text: "The normal hours of work of any employee shall not exceed eight (8) hours a day. (Labor Code, Article 82)" },
                    { id: "LAB_279", title: "Security of Tenure", text: "In cases of regular employment, the employer shall not terminate services except for a just cause. (Labor Code, Article 279)" }
                ];
                
                const lawsContext = PHILIPPINE_LAWS.map(law => 
                    `[${law.id}: ${law.title}] ${law.text}`
                ).join('\n\n');
                
                const systemPrompt = `You are Karapatan Pinoy Legal AI. Answer using ONLY these embedded Philippine laws. Cite law IDs like [CONST_1].

EMBEDDED PHILIPPINE LAWS:
${lawsContext}

Question: ${message}

Answer:`;
                
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userApiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: message }
                        ],
                        max_tokens: 1500,
                        temperature: 0.3
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                chatHistory.innerHTML += `
                    <div class="message">
                        <div class="ai-message">${aiResponse}</div>
                    </div>
                `;
                
            } catch (error) {
                console.error('API Error:', error);
                chatHistory.innerHTML += `
                    <div class="message">
                        <div class="ai-message">‚ö†Ô∏è Karapatan Pinoy Error: ${error.message}<br><br>
                        <strong>Solution:</strong><br>
                        1. Check if /api/deepseek.js is deployed<br>
                        2. Verify your Vercel URL is correct<br>
                        3. Check browser console for details
                        </div>
                    </div>
                `;
            } finally {
                sendButton.textContent = 'Send';
                sendButton.disabled = false;
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Enter key support
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey && isConnected) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Check for saved API key
            const savedKey = localStorage.getItem('karapan_api_key');
            if (savedKey) {
                apiKeyInput.value = savedKey;
                setTimeout(connectApi, 1000);
            }
            
            // IMPORTANT: Update this to your actual Vercel URL
            const currentHost = window.location.hostname;
            if (currentHost !== 'localhost' && currentHost !== '127.0.0.1') {
                // Uncomment and update with your Vercel URL
                // PROXY_URL = `https://${currentHost}/api/deepseek`;
                console.log('Deployed on:', currentHost);
            }
        });
    </script>
</body>
</html>
