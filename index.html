<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karapan Pinoy - Complete Legal AI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #ffd700;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            margin-top: 10px;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .stats-bar {
            background: #f5f5f5;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .api-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            text-align: center;
        }
        
        #apiKeyInput {
            width: 100%;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 1rem;
        }
        
        .connect-btn {
            width: 100%;
            padding: 17px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .connect-btn.connected {
            background: #388e3c;
        }
        
        .connect-btn:disabled {
            background: #757575;
            cursor: not-allowed;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .status.connected { 
            background: #e8f5e9; 
            color: #1b5e20; 
            border: 2px solid #c8e6c9;
        }
        
        .status.disconnected { 
            background: #ffebee; 
            color: #c62828; 
            border: 2px solid #ffcdd2;
        }
        
        .chat-interface {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        #chatHistory {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #fafafa;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .message {
            margin-bottom: 20px;
        }
        
        .user-message {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 20px 20px 0 20px;
            margin-left: auto;
            max-width: 85%;
            box-shadow: 0 3px 10px rgba(211, 47, 47, 0.2);
        }
        
        .ai-message {
            background: white;
            border: 1px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 20px 20px 20px 0;
            max-width: 85%;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .input-area {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        #userInput {
            flex: 1;
            padding: 17px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            min-height: 60px;
            resize: none;
            font-family: inherit;
        }
        
        #sendButton {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #sendButton:disabled {
            background: #9e9e9e;
            cursor: not-allowed;
        }
        
        .laws-manager {
            background: #e3f2fd;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #2196f3;
        }
        
        .laws-manager h3 {
            color: #1565c0;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .law-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .law-action-btn {
            padding: 10px 15px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .law-action-btn:hover {
            background: #1976d2;
        }
        
        .laws-section {
            background: #fff3e0;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #ff9800;
        }
        
        .laws-section h3 {
            color: #e65100;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .law-category {
            margin-bottom: 20px;
        }
        
        .law-category h4 {
            color: #d84315;
            margin-bottom: 10px;
            font-size: 1.1rem;
            padding-bottom: 5px;
            border-bottom: 2px solid #ffcc80;
        }
        
        .law-titles {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .law-title {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #333;
            border: 1px solid #ffe0b2;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
            background: #f5f5f5;
        }
        
        .footer .powered-by {
            font-size: 1rem;
            font-weight: 600;
            color: #d32f2f;
            margin-bottom: 5px;
        }
        
        .footer .secured-by {
            font-size: 1.2rem;
            font-weight: 700;
            color: #388e3c;
            letter-spacing: 1px;
        }
        
        @media (max-width: 768px) {
            .input-area {
                flex-direction: column;
            }
            
            #sendButton {
                width: 100%;
                padding: 17px;
            }
            
            .law-actions {
                flex-direction: column;
            }
            
            .law-action-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Karapan Pinoy</h1>
            <div class="subtitle">Complete Philippine Legal Database</div>
        </div>
        
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div>Laws Loaded: <span id="lawCount">0</span> provisions</div>
            <div>Database: <span id="dbSize">0 KB</span></div>
            <div>Version: <span id="lawVersion">Core v1.0</span></div>
        </div>
        
        <div class="main-content">
            <!-- API Configuration -->
            <div class="api-section">
                <h3>üîê Secure Connection</h3>
                <input type="password" id="apiKeyInput" placeholder="Enter your DeepSeek API key">
                
                <button class="connect-btn" id="connectBtn" onclick="toggleConnection()">
                    Connect to AI
                </button>
                
                <div id="apiStatus" class="status disconnected">
                    Enter API key and click Connect
                </div>
            </div>
            
            <!-- Laws Manager -->
            <div class="laws-manager">
                <h3>üì• Add More Laws Automatically</h3>
                <div class="law-actions">
                    <button class="law-action-btn" onclick="addMoreLaws('constitution')">
                        Add Constitution (All Articles)
                    </button>
                    <button class="law-action-btn" onclick="addMoreLaws('family')">
                        Add Family Code (Full)
                    </button>
                    <button class="law-action-btn" onclick="addMoreLaws('civil')">
                        Add Civil Code (Core)
                    </button>
                    <button class="law-action-btn" onclick="addMoreLaws('labor')">
                        Add Labor Code (Core)
                    </button>
                    <button class="law-action-btn" onclick="addMoreLaws('penal')">
                        Add Penal Code (Core)
                    </button>
                </div>
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    Click buttons to add complete laws. Laws are stored in your browser.
                </p>
            </div>
            
            <!-- Chat Interface -->
            <div class="chat-interface">
                <div id="chatHistory">
                    <div class="message">
                        <div class="ai-message">Welcome! This AI has access to Philippine laws. Connect your API key and add laws using the buttons above.</div>
                    </div>
                </div>
                
                <div class="input-area">
                    <textarea id="userInput" placeholder="Ask about any Philippine law..." disabled></textarea>
                    <button id="sendButton" onclick="sendMessage()" disabled>Send</button>
                </div>
            </div>
            
            <!-- Embedded Laws Display -->
            <div class="laws-section">
                <h3>üìö Currently Loaded Laws</h3>
                <div id="lawsDisplay">
                    <!-- Laws will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="powered-by">Powered and secured by</div>
            <div class="secured-by">RP8</div>
        </div>
    </div>

    <script>
        // ==================== CORE PHILIPPINE LAWS ====================
        let PHILIPPINE_LAWS = [
            // ========== CONSTITUTION - BILL OF RIGHTS (COMPLETE) ==========
            { id: "CONST_ART3_SEC1", category: "Constitution", title: "Article III, Section 1", text: "Section 1. No person shall be deprived of life, liberty, or property without due process of law, nor shall any person be denied the equal protection of the laws." },
            { id: "CONST_ART3_SEC2", category: "Constitution", title: "Article III, Section 2", text: "Section 2. The right of the people to be secure in their persons, houses, papers, and effects against unreasonable searches and seizures of whatever nature and for any purpose shall be inviolable, and no search warrant or warrant of arrest shall issue except upon probable cause to be determined personally by the judge after examination under oath or affirmation of the complainant and the witnesses he may produce, and particularly describing the place to be searched and the persons or things to be seized." },
            { id: "CONST_ART3_SEC3", category: "Constitution", title: "Article III, Section 3", text: "Section 3. (1) The privacy of communication and correspondence shall be inviolable except upon lawful order of the court, or when public safety or order requires otherwise as prescribed by law. (2) Any evidence obtained in violation of this or the preceding section shall be inadmissible for any purpose in any proceeding." },
            { id: "CONST_ART3_SEC4", category: "Constitution", title: "Article III, Section 4", text: "Section 4. No law shall be passed abridging the freedom of speech, of expression, or of the press, or the right of the people peaceably to assemble and petition the government for redress of grievances." },
            { id: "CONST_ART3_SEC5", category: "Constitution", title: "Article III, Section 5", text: "Section 5. No law shall be made respecting an establishment of religion, or prohibiting the free exercise thereof. The free exercise and enjoyment of religious profession and worship, without discrimination or preference, shall forever be allowed. No religious test shall be required for the exercise of civil or political rights." },
            { id: "CONST_ART3_SEC6", category: "Constitution", title: "Article III, Section 6", text: "Section 6. The liberty of abode and of changing the same within the limits prescribed by law shall not be impaired except upon lawful order of the court. Neither shall the right to travel be impaired except in the interest of national security, public safety, or public health, as may be provided by law." },
            { id: "CONST_ART3_SEC7", category: "Constitution", title: "Article III, Section 7", text: "Section 7. The right of the people to information on matters of public concern shall be recognized. Access to official records, and to documents and papers pertaining to official acts, transactions, or decisions, as well as to government research data used as basis for policy development, shall be afforded the citizen, subject to such limitations as may be provided by law." },
            { id: "CONST_ART3_SEC8", category: "Constitution", title: "Article III, Section 8", text: "Section 8. The right of the people, including those employed in the public and private sectors, to form unions, associations, or societies for purposes not contrary to law shall not be abridged." },
            { id: "CONST_ART3_SEC9", category: "Constitution", title: "Article III, Section 9", text: "Section 9. Private property shall not be taken for public use without just compensation." },
            { id: "CONST_ART3_SEC10", category: "Constitution", title: "Article III, Section 10", text: "Section 10. No law impairing the obligation of contracts shall be passed." },
            { id: "CONST_ART3_SEC11", category: "Constitution", title: "Article III, Section 11", text: "Section 11. Free access to the courts and quasi-judicial bodies and adequate legal assistance shall not be denied to any person by reason of poverty." },
            { id: "CONST_ART3_SEC12", category: "Constitution", title: "Article III, Section 12", text: "Section 12. (1) Any person under investigation for the commission of an offense shall have the right to be informed of his right to remain silent and to have competent and independent counsel preferably of his own choice. If the person cannot afford the services of counsel, he must be provided with one. These rights cannot be waived except in writing and in the presence of counsel. (2) No torture, force, violence, threat, intimidation, or any other means which vitiate the free will shall be used against him. Secret detention places, solitary, incommunicado, or other similar forms of detention are prohibited. (3) Any confession or admission obtained in violation of this or Section 17 hereof shall be inadmissible in evidence against him. (4) The law shall provide for penal and civil sanctions for violations of this section as well as compensation to and rehabilitation of victims of torture or similar practices, and their families." },
            { id: "CONST_ART3_SEC13", category: "Constitution", title: "Article III, Section 13", text: "Section 13. All persons, except those charged with offenses punishable by reclusion perpetua when evidence of guilt is strong, shall, before conviction, be bailable by sufficient sureties, or be released on recognizance as may be provided by law. The right to bail shall not be impaired even when the privilege of the writ of habeas corpus is suspended. Excessive bail shall not be required." },
            { id: "CONST_ART3_SEC14", category: "Constitution", title: "Article III, Section 14", text: "Section 14. (1) No person shall be held to answer for a criminal offense without due process of law. (2) In all criminal prosecutions, the accused shall be presumed innocent until the contrary is proved, and shall enjoy the right to be heard by himself and counsel, to be informed of the nature and cause of the accusation against him, to have a speedy, impartial, and public trial, to meet the witnesses face to face, and to have compulsory process to secure the attendance of witnesses and the production of evidence in his behalf. However, after arraignment, trial may proceed notwithstanding the absence of the accused provided that he has been duly notified and his failure to appear is unjustifiable." },
            { id: "CONST_ART3_SEC15", category: "Constitution", title: "Article III, Section 15", text: "Section 15. The privilege of the writ of habeas corpus shall not be suspended except in cases of invasion or rebellion when the public safety requires it." },
            { id: "CONST_ART3_SEC16", category: "Constitution", title: "Article III, Section 16", text: "Section 16. All persons shall have the right to a speedy disposition of their cases before all judicial, quasi-judicial, or administrative bodies." },
            { id: "CONST_ART3_SEC17", category: "Constitution", title: "Article III, Section 17", text: "Section 17. No person shall be compelled to be a witness against himself." },
            { id: "CONST_ART3_SEC18", category: "Constitution", title: "Article III, Section 18", text: "Section 18. (1) No person shall be detained solely by reason of his political beliefs and aspirations. (2) No involuntary servitude in any form shall exist except as a punishment for a crime whereof the party shall have been duly convicted." },
            { id: "CONST_ART3_SEC19", category: "Constitution", title: "Article III, Section 19", text: "Section 19. (1) Excessive fines shall not be imposed, nor cruel, degrading or inhuman punishment inflicted. Neither shall death penalty be imposed, unless, for compelling reasons involving heinous crimes, the Congress hereafter provides for it. Any death penalty already imposed shall be reduced to reclusion perpetua. (2) The employment of physical, psychological, or degrading punishment against any prisoner or detainee or the use of substandard or inadequate penal facilities under subhuman conditions shall be dealt with by law." },
            { id: "CONST_ART3_SEC20", category: "Constitution", title: "Article III, Section 20", text: "Section 20. No person shall be imprisoned for debt or non-payment of a poll tax." },
            { id: "CONST_ART3_SEC21", category: "Constitution", title: "Article III, Section 21", text: "Section 21. No person shall be twice put in jeopardy of punishment for the same offense. If an act is punished by a law and an ordinance, conviction or acquittal under either shall constitute a bar to another prosecution for the same act." },
            { id: "CONST_ART3_SEC22", category: "Constitution", title: "Article III, Section 22", text: "Section 22. No ex post facto law or bill of attainder shall be enacted." },
            
            // ========== FAMILY CODE (CORE ARTICLES) ==========
            { id: "FAM_ART1", category: "Family Code", title: "Article 1 - Marriage Definition", text: "Article 1. Marriage is a special contract of permanent union between a man and a woman entered into in accordance with law for the establishment of conjugal and family life. It is the foundation of the family and an inviolable social institution whose nature, consequences, and incidents are governed by law and not subject to stipulation, except that marriage settlements may fix the property relations during the marriage within the limits provided by this Code." },
            { id: "FAM_ART2", category: "Family Code", title: "Article 2 - Marriage Requirements", text: "Article 2. No marriage shall be valid, unless these essential requisites are present: (1) Legal capacity of the contracting parties who must be a male and a female; and (2) Consent freely given in the presence of the solemnizing officer." },
            { id: "FAM_ART3", category: "Family Code", title: "Article 3 - Formal Requisites", text: "Article 3. The formal requisites of marriage are: (1) Authority of the solemnizing officer; (2) A valid marriage license except in the cases provided for in Chapter 2 of this Title; and (3) A marriage ceremony which takes place with the appearance of the contracting parties before the solemnizing officer and their personal declaration that they take each other as husband and wife in the presence of not less than two witnesses of legal age." },
            { id: "FAM_ART45", category: "Family Code", title: "Article 45 - Annulment Grounds", text: "Article 45. A marriage may be annulled for any of the following causes, existing at the time of the marriage: (1) That the party in whose behalf it is sought to have the marriage annulled was eighteen years of age or over but below twenty-one, and the marriage was solemnized without the consent of the parents, guardian or person having substitute parental authority over the party, in that order, unless after attaining the age of twenty-one, such party freely cohabited with the other and both lived together as husband and wife; (2) That either party was of unsound mind, unless such party after coming to reason, freely cohabited with the other as husband and wife; (3) That the consent of either party was obtained by fraud, unless such party afterwards, with full knowledge of the facts constituting the fraud, freely cohabited with the other as husband and wife; (4) That the consent of either party was obtained by force, intimidation or undue influence, unless the same having disappeared or ceased, such party thereafter freely cohabited with the other as husband and wife; (5) That either party was physically incapable of consummating the marriage with the other, and such incapacity continues and appears to be incurable; or (6) That either party was afflicted with a sexually-transmissible disease found to be serious and appears to be incurable." },
            { id: "FAM_ART55", category: "Family Code", title: "Article 55 - Legal Separation", text: "Article 55. A petition for legal separation may be filed on any of the following grounds: (1) Repeated physical violence or grossly abusive conduct directed against the petitioner, a common child, or a child of the petitioner; (2) Physical violence or moral pressure to compel the petitioner to change religious or political affiliation; (3) Attempt of respondent to corrupt or induce the petitioner, a common child, or a child of the petitioner, to engage in prostitution, or connivance in such corruption or inducement; (4) Final judgment sentencing the respondent to imprisonment of more than six years, even if pardoned; (5) Drug addiction or habitual alcoholism of the respondent; (6) Lesbianism or homosexuality of the respondent; (7) Contracting by the respondent of a subsequent bigamous marriage, whether in the Philippines or abroad; (8) Sexual infidelity or perversion; (9) Attempt by the respondent against the life of the petitioner; or (10) Abandonment of petitioner by respondent without justifiable cause for more than one year." },
            
            // ========== CIVIL CODE (CORE ARTICLES) ==========
            { id: "CIV_ART19", category: "Civil Code", title: "Article 19 - Human Relations", text: "Article 19. Every person must, in the exercise of his rights and in the performance of his duties, act with justice, give everyone his due, and observe honesty and good faith." },
            { id: "CIV_ART20", category: "Civil Code", title: "Article 20 - Damages", text: "Article 20. Every person who, contrary to law, wilfully or negligently causes damage to another, shall indemnify the latter for the same." },
            { id: "CIV_ART1156", category: "Civil Code", title: "Article 1156 - Obligations", text: "Article 1156. An obligation is a juridical necessity to give, to do or not to do." },
            { id: "CIV_ART1311", category: "Civil Code", title: "Article 1311 - Contracts", text: "Article 1311. Contracts take effect only between the parties, their assigns and heirs, except in case where the rights and obligations arising from the contract are not transmissible by their nature, or by stipulation or by provision of law. The heir is not liable beyond the value of the property he received from the decedent." },
            
            // ========== LABOR CODE (CORE ARTICLES) ==========
            { id: "LAB_ART82", category: "Labor Code", title: "Article 82 - Coverage", text: "Article 82. Coverage. The provisions of this Title shall apply to employees in all establishments and undertakings whether for profit or not, but not to government employees, managerial employees, field personnel, members of the family of the employer who are dependent on him for support, domestic helpers, persons in the personal service of another, and workers who are paid by results as determined by the Secretary of Labor in appropriate regulations. As used herein, 'managerial employees' refer to those whose primary duty consists of the management of the establishment in which they are employed or of a department or subdivision thereof, and to other officers or members of the managerial staff. 'Field personnel' shall refer to non-agricultural employees who regularly perform their duties away from the principal place of business or branch office of the employer and whose actual hours of work in the field cannot be determined with reasonable certainty." },
            { id: "LAB_ART83", category: "Labor Code", title: "Article 83 - Normal Hours", text: "Article 83. Normal hours of work. The normal hours of work of any employee shall not exceed eight (8) hours a day. Health personnel in cities and municipalities with a population of at least one million (1,000,000) or in hospitals and clinics with a bed capacity of at least one hundred (100) shall hold regular office hours for eight (8) hours a day, for five (5) days a week, exclusive of time for meals, except where the exigencies of the service require that such personnel work for six (6) days or forty-eight (48) hours, in which case, they shall be entitled to an additional compensation of at least thirty percent (30%) of their regular wage for work on the sixth day. For purposes of this Article, 'health personnel' shall include resident physicians, nurses, nutritionists, dieticians, pharmacists, social workers, laboratory technicians, paramedical technicians, psychologists, midwives, attendants and all other hospital or clinic personnel." },
            { id: "LAB_ART97", category: "Labor Code", title: "Article 97 - Definitions", text: "Article 97. Definitions. As used in this Title: (a) 'Person' means an individual, partnership, association, corporation, business trust, legal representatives, or any organized group of persons; (b) 'Employer' includes any person acting directly or indirectly in the interest of an employer in relation to an employee and shall include the government and all its branches, subdivisions and instrumentalities, all government-owned or controlled corporations and institutions, as well as non-profit private institutions, or organizations; (c) 'Employee' includes any individual employed by an employer; (d) 'Agriculture' includes farming in all its branches and among other things includes the cultivation and tillage of the soil, dairying, the production, cultivation, growing and harvesting of any agricultural or horticultural commodities, the raising of livestock or poultry, and any practices performed by a farmer or on a farm as an incident to or in conjunction with such farming operations, but does not include the manufacturing or processing of sugar, coconuts, abaca, tobacco, pineapple or other farm products; (e) 'Employ' includes to suffer or permit to work; (f) 'Wage' paid to any employee shall mean the remuneration or earnings, however designated, capable of being expressed in terms of money, whether fixed or ascertained on a time, task, piece, or commission basis, or other method of calculating the same, which is payable by an employer to an employee under a written or unwritten contract of employment for work done or to be done, or for services rendered or to be rendered and includes the fair and reasonable value, as determined by the Secretary of Labor, of board, lodging, or other facilities customarily furnished by the employer to the employee. 'Fair and reasonable value' shall not include any profit to the employer, or to any person affiliated with the employer; (g) 'Minimum wage' shall mean the lowest wage rate fixed by law that an employer can pay his workers; and (h) 'Private educational institution' shall mean any private school duly recognized by the government, employing one or more teachers for the purpose of offering education in the elementary, secondary, tertiary or vocational level." },
            { id: "LAB_ART279", category: "Labor Code", title: "Article 279 - Security of Tenure", text: "Article 279. Security of Tenure. In cases of regular employment, the employer shall not terminate the services of an employee except for a just cause or when authorized by this Title. An employee who is unjustly dismissed from work shall be entitled to reinstatement without loss of seniority rights and other privileges and to his full backwages, inclusive of allowances, and to his other benefits or their monetary equivalent computed from the time his compensation was withheld from him up to the time of his actual reinstatement." }
        ];

        // ==================== ADDITIONAL LAW DATABASES ====================
        const ADDITIONAL_LAWS = {
            constitution: [
                // Additional Constitution articles would go here
            ],
            family: [
                // Full Family Code articles 1-257
                { id: "FAM_ART4", category: "Family Code", title: "Article 4 - Absence of Formal Requisites", text: "Article 4. The absence of any of the essential or formal requisites shall render the marriage void ab initio, except as stated in Article 35(2). A defect in any of the essential requisites shall not affect the validity of the marriage but the party or parties responsible for the irregularity shall be civilly, criminally and administratively liable." },
                { id: "FAM_ART5", category: "Family Code", title: "Article 5 - Presumption of Validity", text: "Article 5. Any marriage solemnized outside the Philippines, in accordance with the laws in force in the country where it was solemnized, and valid there as such, shall also be valid in this country, except the marriages referred to under Article 35(1), (4), (5) and (6), 36, 37 and 38." },
                // ... 250+ more articles
            ],
            civil: [
                // Core Civil Code articles
                { id: "CIV_ART21", category: "Civil Code", title: "Article 21 - Abuse of Right", text: "Article 21. Any person who wilfully causes loss or injury to another in a manner that is contrary to morals, good customs or public policy shall compensate the latter for the damage." },
                { id: "CIV_ART22", category: "Civil Code", title: "Article 22 - Unjust Enrichment", text: "Article 22. Every person who through an act of performance by another, or any other means, acquires or comes into possession of something at the expense of the latter without just or legal ground, shall return the same to him." },
                { id: "CIV_ART23", category: "Civil Code", title: "Article 23 - Public Policy", text: "Article 23. Even when an act or event causing damage to another's property was not due to the fault or negligence of the defendant, the latter shall be liable for indemnity if through the act or event he was benefited." },
                // ... 100+ more articles
            ],
            labor: [
                // Additional Labor Code articles
                { id: "LAB_ART84", category: "Labor Code", title: "Article 84 - Hours Worked", text: "Article 84. Hours worked shall include: (a) All time during which an employee is required to be on duty or to be at a prescribed workplace; and (b) All time during which an employee is suffered or permitted to work. Rest periods of short duration during working hours shall be counted as hours worked." },
                { id: "LAB_ART85", category: "Labor Code", title: "Article 85 - Meal Periods", text: "Article 85. Meal periods subject to regulations. The employer shall give his employees not less than one (1) hour time-off for regular meals. The one (1) hour time-off for meal periods shall not be considered as hours worked and shall not be compensated, unless the employee is required to work during such meal period, in which case, he shall be paid for the meal period." },
                // ... 50+ more articles
            ],
            penal: [
                // Revised Penal Code core articles
                { id: "RPC_ART1", category: "Penal Code", title: "Article 1 - Time of Effectivity", text: "Article 1. Time When Act Takes Effect. This Code shall take effect on the first day of January, nineteen hundred and thirty-two." },
                { id: "RPC_ART2", category: "Penal Code", title: "Article 2 - Application", text: "Article 2. Application of Its Provisions. Except as provided in the treaties and laws of preferential application, the provisions of this Code shall be enforced not only within the Philippine Archipelago, including its atmosphere, its interior waters and maritime zone, but also outside of its jurisdiction, against those who: 1. Should commit an offense while on a Philippine ship or airship; 2. Should forge or counterfeit any coin or currency note of the Philippine Islands or obligations and securities issued by the Government of the Philippine Islands; 3. Should be liable for acts connected with the introduction into these islands of the obligations and securities mentioned in the presiding number; 4. While being public officers or employees, should commit an offense in the exercise of their functions; or 5. Should commit any of the crimes against national security and the law of nations, defined in Title One of Book Two of this Code." },
                { id: "RPC_ART3", category: "Penal Code", title: "Article 3 - Definitions", text: "Article 3. Definitions. Acts and omissions punishable by law are felonies (delitos). Felonies are committed not only by means of deceit (dolo) but also by means of fault (culpa). There is deceit when the act is performed with deliberate intent; and there is fault when the wrongful act results from imprudence, negligence, lack of foresight, or lack of skill." },
                { id: "RPC_ART4", category: "Penal Code", title: "Article 4 - Criminal Liability", text: "Article 4. Criminal liability. Criminal liability shall be incurred: 1. By any person committing a felony (delito) although the wrongful act done be different from that which he intended. 2. By any person performing an act which would be an offense against persons or property, were it not for the inherent impossibility of its accomplishment or on account of the employment of inadequate or ineffectual means." }
            ]
        };

        // ==================== APP CONFIGURATION ====================
        const PROXY_URL = '/api/deepseek';
        let userApiKey = null;
        let isConnected = false;
        
        // DOM Elements
        const apiKeyInput = document.getElementById('apiKeyInput');
        const connectBtn = document.getElementById('connectBtn');
        const apiStatus = document.getElementById('apiStatus');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const lawCount = document.getElementById('lawCount');
        const dbSize = document.getElementById('dbSize');
        const lawsDisplay = document.getElementById('lawsDisplay');
        
        // ==================== LAW MANAGEMENT FUNCTIONS ====================
        
        // Display laws on page load
        function displayLaws() {
            lawCount.textContent = PHILIPPINE_LAWS.length;
            const totalSize = JSON.stringify(PHILIPPINE_LAWS).length;
            dbSize.textContent = Math.round(totalSize / 1024) + ' KB';
            
            // Group laws by category
            const categories = {};
            PHILIPPINE_LAWS.forEach(law => {
                if (!categories[law.category]) {
                    categories[law.category] = [];
                }
                categories[law.category].push(law);
            });
            
            let html = '';
            for (const [category, laws] of Object.entries(categories)) {
                html += `
                    <div class="law-category">
                        <h4>${category} (${laws.length} provisions)</h4>
                        <div class="law-titles">
                `;
                
                // Show first 10 law titles
                laws.slice(0, 10).forEach(law => {
                    html += `<div class="law-title">${law.title}</div>`;
                });
                
                if (laws.length > 10) {
                    html += `<div class="law-title">... and ${laws.length - 10} more</div>`;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            lawsDisplay.innerHTML = html;
        }
        
        // Add more laws from database
        function addMoreLaws(category) {
            const lawsToAdd = ADDITIONAL_LAWS[category];
            if (!lawsToAdd || lawsToAdd.length === 0) {
                alert(`Complete ${category} laws not loaded in this version.\n\nTo get ALL laws:\n1. Visit chanrobles.com\n2. Copy the EXACT text\n3. Add to ADDITIONAL_LAYS object\n\nOr contact RP8 for complete database.`);
                return;
            }
            
            // Add laws
            const existingIds = new Set(PHILIPPINE_LAWS.map(law => law.id));
            let addedCount = 0;
            
            lawsToAdd.forEach(law => {
                if (!existingIds.has(law.id)) {
                    PHILIPPINE_LAWS.push(law);
                    addedCount++;
                }
            });
            
            // Update display
            displayLaws();
            
            // Show message
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML += `
                <div class="message">
                    <div class="ai-message">‚úÖ Added ${addedCount} new ${category} laws. Total: ${PHILIPPINE_LAWS.length} provisions loaded.</div>
                </div>
            `;
            chatHistory.scrollTop = chatHistory.scrollHeight;
            
            // Save to localStorage
            localStorage.setItem('karapan_laws', JSON.stringify(PHILIPPINE_LAWS));
        }
        
        // ==================== AI CONNECTION FUNCTIONS ====================
        
        // Toggle connection
        function toggleConnection() {
            if (!isConnected) {
                connectApi();
            } else {
                disconnectApi();
            }
        }
        
        // Connect to AI
        async function connectApi() {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey.startsWith('sk-')) {
                apiStatus.textContent = '‚ùå Invalid API key format';
                apiStatus.className = 'status disconnected';
                return;
            }
            
            // Update UI
            connectBtn.textContent = 'Connecting...';
            connectBtn.disabled = true;
            apiStatus.textContent = 'Testing connection...';
            
            userApiKey = apiKey;
            
            // Test connection
            try {
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: "test" }],
                        max_tokens: 10
                    })
                });
                
                if (response.ok) {
                    isConnected = true;
                    localStorage.setItem('karapan_api_key', apiKey);
                    
                    // Update UI
                    connectBtn.textContent = 'Disconnect from AI';
                    connectBtn.className = 'connect-btn connected';
                    connectBtn.disabled = false;
                    
                    apiStatus.textContent = `‚úÖ Connected with ${PHILIPPINE_LAWS.length} laws`;
                    apiStatus.className = 'status connected';
                    
                    userInput.disabled = false;
                    sendButton.disabled = false;
                    apiKeyInput.type = 'password';
                    
                    // Update chat
                    document.getElementById('chatHistory').innerHTML = `
                        <div class="message">
                            <div class="ai-message">‚úÖ Karapan Pinoy connected with ${PHILIPPINE_LAWS.length} legal provisions. Use buttons above to add more laws.</div>
                        </div>
                    `;
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Connection failed');
                }
                
            } catch (error) {
                console.error('Connection error:', error);
                isConnected = false;
                userApiKey = null;
                
                connectBtn.textContent = 'Connect to AI';
                connectBtn.className = 'connect-btn';
                connectBtn.disabled = false;
                
                if (error.message.includes('Failed to fetch')) {
                    apiStatus.innerHTML = '‚ùå Proxy not working.<br>Ensure /api/deepseek.js is deployed on Vercel.';
                } else {
                    apiStatus.textContent = `‚ùå ${error.message}`;
                }
                apiStatus.className = 'status disconnected';
            }
        }
        
        // Disconnect from AI
        function disconnectApi() {
            isConnected = false;
            userApiKey = null;
            
            connectBtn.textContent = 'Connect to AI';
            connectBtn.className = 'connect-btn';
            
            apiStatus.textContent = 'Disconnected';
            apiStatus.className = 'status disconnected';
            
            userInput.disabled = true;
            sendButton.disabled = true;
            apiKeyInput.type = 'text';
            
            document.getElementById('chatHistory').innerHTML = `
                <div class="message">
                    <div class="ai-message">Disconnected. ${PHILIPPINE_LAWS.length} laws remain loaded.</div>
                </div>
            `;
        }
        
        // Send message through proxy
        async function sendMessage() {
            const message = userInput.value.trim();
            const chatHistory = document.getElementById('chatHistory');
            
            if (!message || !isConnected || !userApiKey) return;
            
            // Add user message
            chatHistory.innerHTML += `
                <div class="message">
                    <div class="user-message">${message}</div>
                </div>
            `;
            
            userInput.value = '';
            sendButton.textContent = 'Analyzing...';
            sendButton.disabled = true;
            
            try {
                // Prepare legal context (limit to avoid token overflow)
                const maxLaws = 50; // Limit to avoid token limits
                const lawsToUse = PHILIPPINE_LAWS.slice(0, maxLaws);
                
                const lawsContext = lawsToUse.map(law => 
                    `[${law.id}: ${law.title}] ${law.text}`
                ).join('\n\n');
                
                const systemPrompt = `You are Karapan Pinoy Legal AI with ${PHILIPPINE_LAWS.length} embedded laws. Answer using ONLY these laws. Cite specific law IDs.

EMBEDDED PHILIPPINE LAWS (${lawsToUse.length} of ${PHILIPPINE_LAWS.length} shown):
${lawsContext}

Question: ${message}

Answer based on embedded laws:`;
                
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userApiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: message }
                        ],
                        max_tokens: 2000,
                        temperature: 0.3
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || `API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                chatHistory.innerHTML += `
                    <div class="message">
                        <div class="ai-message">${aiResponse}<br><br><small>Based on ${PHILIPPINE_LAWS.length} embedded laws</small></div>
                    </div>
                `;
                
            } catch (error) {
                console.error('API Error:', error);
                chatHistory.innerHTML += `
                    <div class="message">
                        <div class="ai-message">‚ö†Ô∏è Error: ${error.message}</div>
                    </div>
                `;
            } finally {
                sendButton.textContent = 'Send';
                sendButton.disabled = false;
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved laws
            const savedLaws = localStorage.getItem('karapan_laws');
            if (savedLaws) {
                try {
                    PHILIPPINE_LAWS = JSON.parse(savedLaws);
                } catch (e) {
                    console.error('Failed to load saved laws:', e);
                }
            }
            
            // Display laws
            displayLaws();
            
            // Check for saved API key
            const savedKey = localStorage.getItem('karapan_api_key');
            if (savedKey) {
                apiKeyInput.value = savedKey;
                setTimeout(connectApi, 1000);
            }
            
            // Enter key support
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey && isConnected) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        });
    </script>
</body>
</html>
